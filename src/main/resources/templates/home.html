<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>
<div class="container">
    <div class="page-header">
        <h1 class="page-title">Workout Tracker</h1>
        <div class="page-actions">
            <a href="/progress" class="btn btn-info">View Progress</a>
            <form th:action="@{/logout}" method="post" style="display: inline;">
                <button type="submit" class="btn btn-outline">Logout</button>
            </form>
        </div>
    </div>

    <hr class="divider">

    <!-- Success Message -->
    <div th:if="${success}" class="alert alert-success">
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
    </div>

    <!-- Error Message -->
    <div th:if="${error}" class="alert alert-danger">
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
    </div>

    <div class="card card-light">
        <h3>Start a New Workout</h3>
        <form th:action="@{/workouts/create}"
              th:object="${workoutCreateDto}"
              method="post"
              class="row align-items-end">

            <div class="col-6">
                <label for="workoutDate" class="form-label">Workout Date</label>
                <input type="date"
                       id="workoutDate"
                       th:field="*{workoutDate}"
                       class="form-control"
                       th:classappend="${#fields.hasErrors('workoutDate')} ? 'invalid' : ''"
                       required>
                <div class="invalid-feedback" th:if="${#fields.hasErrors('workoutDate')}">
                    <span th:errors="*{workoutDate}"></span>
                </div>
            </div>

            <div class="col-4">
                <label for="title" class="form-label">Title (e.g., Chest Day)</label>
                <input type="text"
                       id="title"
                       th:field="*{title}"
                       class="form-control"
                       th:classappend="${#fields.hasErrors('title')} ? 'invalid' : ''"
                       maxlength="50"
                       required>
                <div class="invalid-feedback" th:if="${#fields.hasErrors('title')}">
                    <span th:errors="*{title}"></span>
                </div>
            </div>

            <div class="col-2">
                <button type="submit" class="btn btn-primary btn-full">Create Workout</button>
            </div>
        </form>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-2">
        <h2>Workout History</h2>
    </div>

    <!-- Search Filter -->
    <div class="filter-section" th:unless="${workouts.isEmpty()}">
        <div class="row align-items-end">
            <div class="col-6">
                <label for="titleSearch" class="form-label">Search by Title</label>
                <input type="text" id="titleSearch" class="form-control" placeholder="Type to search workouts...">
            </div>
            <div class="col-3">
                <label for="dateSearch" class="form-label">Filter by Date</label>
                <input type="date" id="dateSearch" class="form-control">
            </div>
            <div class="col-2">
                <button type="button" id="clearSearch" class="btn btn-outline btn-full">Clear Filters</button>
            </div>
            <div class="col">
                <small class="text-muted" id="resultCount"></small>
            </div>
        </div>
    </div>

    <div th:if="${workouts.isEmpty()}" class="alert alert-info">
        You haven't logged any workouts yet.
    </div>

    <div id="noResultsMessage" class="alert alert-warning" style="display: none;">
        No workouts found matching your search criteria.
    </div>

    <div class="list-group" th:unless="${workouts.isEmpty()}" id="workoutList">
        <div th:each="workout : ${workouts}" class="list-item workout-item"
             th:attr="data-title=${workout.title}, data-date=${#temporals.format(workout.workoutDate, 'yyyy-MM-dd')}">
            <a th:href="@{/workout/{id}(id=${workout.id})}" class="list-item-content">
                <h5 class="list-item-title" th:text="${workout.title}">Workout Title</h5>
                <small class="list-item-subtitle" th:text="${#temporals.format(workout.workoutDate, 'MMMM dd, yyyy')}">Date</small>
            </a>
            <form th:action="@{/workouts/{id}/delete(id=${workout.id})}" method="post" class="list-item-actions">
                <button type="submit" class="btn-close" onclick="return confirm('Are you sure you want to delete this workout?');"></button>
            </form>
        </div>
    </div>
</div>

<script th:src="@{/js/home.js}"></script>

</body>
</html>